<% breadcrumb([link_to('Service Points', availability_service_points_path), h(@service_point.name)]) %>

<% content_title(h(@service_point.name)) %>

<% content_for(:right_column) do %>
  <h3>Current Hours</h3>

  <%= raw @service_point.render %>

  <a href="<%= print_availability_service_points_print_path(@service_point) %>" target="blank" class="btn btn-success"><i class="icon-print icon-white"></i> Print Current Hours</a>
  <%= help_popover("Print Current Hours", "Geneates a document that can be hung to advertise hours.") %>
<% end  %>


<p>
  <a href="#cloneRegularHours" data-toggle="modal" class="btn">Add Regular Hours</a>
  <a href="#cloneHoursExceptions" data-toggle="modal" class="btn">Add Exception</a>
</p>

<h2>Regular Hours <%= help_popover("Regular Hours", "Regular Hours are the normal hours the service point is open.") %></h2>

<table class="table table-striped table-condensed">
 <thead>
 <tr>
   <th>Name</th>
   <th>Published Dates <%= help_popover("Publish Dates", "The dates that the regular hours will appear on the site.  Make sure there are no gaps in published dates for hours scheduled into the future.") %></th>
   <th class="hours_display">Hours</th>
 </tr>
 </thead>
 <tbody>
<% previous_row = nil %>
<% if @service_point.no_current_hours? %>
  <tr class="error">
    <td colspan="3" class="alert alert-error"><%= t(:no_current_hours_error_message, :service_name => @service_point.name) %></td>
  </tr>
<% end %>
<% @service_point.upcoming_regular_hours.each do | hours | %>

  <% if @service_point.gap_between_regular_hours?(hours, previous_row) %>
    <tr class="error">
      <td colspan="3" class="alert alert-error"><%= t(:gap_in_between_regular_hours, :end_date => previous_row.end_date.to_date.to_s(:long_ordinal), :start_date => hours.start_date.to_date.to_s(:long_ordinal)) %></td>
    </tr>
  <% end %>
  <tr>
    <td><%= link_to h(hours.name), edit_availability_service_point_regular_hour_path(@service_point, hours) %></td>
    <td><%= hours.start_date.to_date.to_s(:long_ordinal) %> - <%=  hours.end_date.to_date.to_s(:long_ordinal) %></td>
    <td>
      <%= raw @service_point.render_hours(hours) %>
    </td>
  </tr>
  <% previous_row = hours %>
<% end %>
 </tbody>
</table>
<% if @service_point.upcoming_regular_hours.size == 0 %>
    <div class="alert alert-info">There are no regular hours associated with this service point.</div>
<% end %>


<h2>Exceptions  <%= help_popover("Exceptions", "Exceptions are changes in the regular hours for the service point.  They appear below the regular hours when they are active. ") %></h2>


<table class="table table-striped table-condensed">
  <thead>
  <tr>
    <th>Name</th>
    <th>Published Dates <%= help_popover("Publish Dates", "The dates that the exception hours will appear on the site.  You may wish to publish the exceptions a week or two ahead of the actual exception date to give advanced notice of the change.") %></th>
    <th class="hours_display">Hours</th>
  </tr>
  </thead>
  <tbody>
  <% @service_point.upcoming_hours_exceptions.each do | hours | %>
      <tr>
        <td><%= link_to h(hours.name), edit_availability_service_point_hours_exception_path(@service_point, hours) %></td>
        <td><%= hours.start_date.to_date.to_s(:long_ordinal) %> - <%=  hours.end_date.to_date.to_s(:long_ordinal) %></td>
        <td>
          <%= raw @service_point.render_hours(hours)%>
        </td>
      </tr>
  <% end %>
  </tbody>
</table>
<% if @service_point.upcoming_hours_exceptions.size == 0 %>
    <div class="alert alert-info">There are no exceptions associated with this service point.</div>
<% end %>


<div id="cloneRegularHours" class="modal hide fade" tabindex="-1">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">×</button>
    <h3>New Regular Hours</h3>
  </div>
  <div class="modal-body">
    <form action="<%= new_availability_service_point_regular_hour_path(@service_point) %>" id="cloneRegularHoursForm" method="get">
      <select name="clone_id">
        <option value="">Create New Regular Hours</option>
        <optgroup label="Copy From">
        <% @service_point.regular_hours_that_can_be_cloned.each do | hours | %>
          <option value="<%= hours.id %>"><%= hours.name %> (<%= l(hours.start_date, :format => :us) %> - <%= l(hours.end_date, :format => :us) %>)</option>
        <% end %>
        </optgroup>
      </select>
      <p class="help-block">Select to create either a new hours or copy an existing hours.</p>
    </form>
  </div>
  <div class="modal-footer">
    <a href="#" class="btn" data-dismiss="modal">Close</a>
    <a href="#" class="btn btn-primary hours_continue_button">Continue</a>
  </div>
</div>


<div id="cloneHoursExceptions" class="modal hide fade" tabindex="-1">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">×</button>
    <h3>New Exception</h3>
  </div>
  <div class="modal-body">
    <form action="<%= new_availability_service_point_hours_exception_path(@service_point) %>" id="cloneHoursExceptionsForm" method="get">
      <select name="clone_id">
        <option value="">Create New Exception</option>
        <optgroup label="Copy From">
        <% @service_point.hours_exceptions_that_can_be_cloned.each do | hours | %>
            <option value="<%= hours.id %>"><%= hours.name %> (<%= l(hours.start_date, :format => :us) %> - <%= l(hours.end_date, :format => :us) %>)</option>
        <% end %>
        </optgroup>
      </select>
      <p class="help-block">Select to create either a new exception or copy an existing exception.</p>
    </form>
  </div>
  <div class="modal-footer">
    <a href="#" class="btn" data-dismiss="modal">Close</a>
    <a href="#" class="btn btn-primary hours_continue_button">Continue</a>
  </div>
</div>
