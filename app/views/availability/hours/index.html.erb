<% breadcrumb([link_to('Service Points', availability_service_points_path), h(@service_point.name)]) %>

<% content_for(:right_column) do %>
  <h3>Current Hours</h3>
  <p class="tagline" id="destination"></p>
  <script type="text/javascript">
    jQuery(document).ready(function () {
      getServiceHours({ <%= @service_point.code %>: '#destination' });
    });
  </script>

  <a href="<%= availability_service_point_path(@service_point) %>" target="blank" class="btn btn-success"><i class="icon-print icon-white"></i> Print Current Hours</a>
<% end  %>

<h1><%= h @service_point.name %></h1>

<p>
  <a href="#cloneRegularHours" data-toggle="modal" class="btn">Add Regular Hours</a>
  <a href="#cloneHoursExceptions" data-toggle="modal" class="btn">Add Exception</a>
</p>

<h2>Regular Hours <%= help_popover("Regular Hours", "Regular Hours are the normal hours the service point is open.  Make sure there are no gaps in published dates for hours scheduled into the future..") %></h2>

<table class="table table-striped table-condensed">
 <thead>
 <tr>
   <th>Name</th>
   <th>Published Dates</th>
   <th class="hours_display">Hours</th>
 </tr>
 </thead>
 <tbody>
<% previous_row = "" %>
<% @service_point.upcoming_regular_hours.each do | hours | %>
  <% hours = Availability::HoursPresenter.new(hours, self) %>
  <% if gap_in_regular_hours?(hours, previous_row) %>
    <tr class="error">
      <td colspan="3" class="alert alert-error"><strong>The end date of the previous hours is not continuous with the start date of the next hours. This will cause no hours to appear on the website. </strong></td>
    </tr>
  <% end %>
  <tr>
    <td><%= link_to h(hours.name), edit_availability_service_point_regular_hour_path(@service_point, hours) %></td>
    <td><%= hours.start_date.to_date.to_s(:long_ordinal) %> - <%=  hours.end_date.to_date.to_s(:long_ordinal) %></td>
    <td>
      <%= raw hours.render %>
    </td>
  </tr>
  <% previous_row = hours %>
<% end %>
 </tbody>
</table>


<h2>Exceptions  <%= help_popover("Exceptions", "Exceptions are changes in the regular hours for the service point.  They appear below the regular hours when they are active. ") %></h2>


<table class="table table-striped table-condensed">
  <thead>
  <tr>
    <th>Name</th>
    <th>Published Dates</th>
    <th class="hours_display">Hours</th>
  </tr>
  </thead>
  <tbody>
  <% @service_point.upcoming_hours_exceptions.each do | hours | %>
      <% hours = Availability::HoursPresenter.new(hours, self) %>
      <tr>
        <td><%= link_to h(hours.name), edit_availability_service_point_hours_exception_path(@service_point, hours) %></td>
        <td><%= hours.start_date.to_date.to_s(:long_ordinal) %> - <%=  hours.end_date.to_date.to_s(:long_ordinal) %></td>
        <td>
          <%= raw hours.render %>
        </td>
      </tr>
  <% end %>
  </tbody>
</table>


<div id="cloneRegularHours" class="modal hide fade" tabindex="-1">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">×</button>
    <h3>New Regular Hours</h3>
  </div>
  <div class="modal-body">
    <form action="<%= new_availability_service_point_regular_hour_path(@service_point) %>" id="cloneRegularHoursForm" method="get">
      <select name="clone_id">
        <option value="">Create New Regular Hours</option>
        <optgroup label="Copy From">
        <% @service_point.regular_hours_that_can_be_cloned.each do | hours | %>
          <option value="<%= hours.id %>"><%= hours.name %> (<%= l(hours.start_date, :format => :us) %> - <%= l(hours.end_date, :format => :us) %>)</option>
        <% end %>
        </optgroup>
      </select>
      <p class="help-block">Select to create either a new hours or copy an existing hours.</p>
    </form>
  </div>
  <div class="modal-footer">
    <a href="#" class="btn" data-dismiss="modal">Close</a>
    <a href="#" class="btn btn-primary hours_continue_button">Continue</a>
  </div>
</div>


<div id="cloneHoursExceptions" class="modal hide fade" tabindex="-1">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">×</button>
    <h3>New Exception</h3>
  </div>
  <div class="modal-body">
    <form action="<%= new_availability_service_point_hours_exception_path(@service_point) %>" id="cloneHoursExceptionsForm" method="get">
      <select name="clone_id">
        <option value="">Create New Exception</option>
        <optgroup label="Copy From">
        <% @service_point.hours_exceptions_that_can_be_cloned.each do | hours | %>
            <option value="<%= hours.id %>"><%= hours.name %> (<%= l(hours.start_date, :format => :us) %> - <%= l(hours.end_date, :format => :us) %>)</option>
        <% end %>
        </optgroup>
      </select>
      <p class="help-block">Select to create either a new exception or copy an existing exception.</p>
    </form>
  </div>
  <div class="modal-footer">
    <a href="#" class="btn" data-dismiss="modal">Close</a>
    <a href="#" class="btn btn-primary hours_continue_button">Continue</a>
  </div>
</div>